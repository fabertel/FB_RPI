SELECT DISTINCT 
	(T2148.OVERALL_NEED_BY_DATE)   ,    
	(T2148.FIRST_CONTRACTUAL_DATE)  ,   
--	(T2148.OVERALL_PROMIDES_DATE)    ,  
	(T2148.PROMISED_DATE)				,
	(T2148.CONTRACTUAL_DATE)        	,
	(T2148.OVERALL_APPROVED_DATE)   ,
	(T2148.APPROVED_DATE)      ,
	(T2148.NEED_BY_DATE)        ,       
--	(T2909.ARRIVAL_DATE)           ,
	(T10156.RTS_DATE)              ,
	(T10156.ACTPICKUP_DATE)        ,
	(T10156.PROPOSED_RTS_DATE)     ,
	(T10156.REQPICKUP_DATE)        ,
--	(T10229.DMD_CUSTOMER_WANT_DATE),
--	(T2106.APPROVED_DATE)          ,
--	(T2077.APPROVED_DATE)          ,
--	(T11079.LAST_TRANSACTION_DATE) 
  SYSDATE,
  CASE
    WHEN T2148.PROMISED_DATE >= 1 + TO_DATE('2019-06-17' , 'YYYY-MM-DD')
    THEN 'Expired'
    ELSE 'Lookahead'
  END AS PD_STATUS,
  T2148.COUNTRY_OF_ORIGIN_CODE   ,
  T2148.SHIPMENT_AMOUNT_FUNCT    ,
  T2148.UNIT_PRICE_EUR                     ,
  T2148.UNIT_PRICE_USD                     ,
  T2148.UNIT_PRICE_FUNCT         ,
  T2148.FUNCTIONAL_CURRENCY      ,
  T2148.SHIPMENT_AMOUNT          ,
--  T2148.UNIT_PRICE               AS c27,
--  T2148.OVERALL_QUANTITY_ORDERED AS c28,
--  T2148.LINE_LOC_CLOSED_CODE     AS c29,
--  T2148.NOTE_TO_RECEIVER         AS c30,
  CASE
    WHEN INSTR(T2148.NOTE_TO_RECEIVER,'COA12PO=') <> 0
    THEN 'Y'
    ELSE 'N'
  END                                                                                                                                                                        AS COA12PO,
  T2106.ORG_ID                     ,
  T2106.PO_NUMBER                  ,
  T2106.REVISION_NUM               ,
  T2148.DISTRIBUTION_NUMBER,
  T2148.SHIPMENT_NUM,
  T2148.LINE_NUM,
  CASE
    WHEN T2135.RELEASE_NUM IS NULL
    THEN NULL
    ELSE T2135.RELEASE_NUM
  END AS REL,
  T2156.IO_ORGANIZATION_CODE,
  T2156.NAME,
  T2148.ITEM_DESCRIPTION,
  T2148.DUMMY_ITEM_CODE,
  CASE
    WHEN T3524.END_ASSEMBLY_PEGGING_FLAG IN ('I', 'X')
    THEN 'HARD'
    ELSE 'SOFT'
  END                          AS HARDSOFT,
  T3524.ITEM_APPLICABLE_DOC    ,
  T3524.ITEM_CODE              ,
  T2158.ITEM_CATEGORY          ,
  T2158.PRODUCT_CODE_DESCR_ENG ,
  T2158.PRODUCT_CODE           ,
--  T2158.UNSPSC_CODE            ,
--  T2909.ANOMALY_WF_NUMBER      ,
--  T2909.RNK_ARR_QTY            ,
--  T10156.CONFIRMED_RTS         ,
--  T10156.DEST_CODE             ,
--  T10156.END_ITEM_PROJECT_CODE ,
  T10156.FREE_TEXT             ,
  T10156.JUSTIFICATION         ,
  CASE
    WHEN T10156.RTS_DATE IS NULL
    THEN 'N'
    ELSE 'Y'
  END           AS RTS_DATE_AVAILABLE,
  T10156.RFT_ID,
  CASE
    WHEN T10156.RTS_DATE    <= SYSDATE
    AND NOT T10156.RTS_DATE IS NULL
    THEN 'Closed Vs Contractual'
    ELSE 'Open Vs Contractual'
  END AS Status_v_contractual,
--  T10156.UPD_DEST_CODE             AS c64,
--  T10156.WEBTRANSP_ID              AS c65,
--  T10156.WIP_JOB_NUM               AS c66,
--  T10229.AWD_INSTALLATION_COUNTRY  AS c67,
--  T10229.AWD_INSTALLATION_LOCATION AS c68,
--  T10229.AWD_SHIP_TO_LOCATION      ,
--  T2104.FULL_NAME             AS BUYER     ,
--  T6769.TASK_NUMBER                ,
  T1738.FULL_NAME                  ,
  T2106.COA12_CHILD_FLAG           ,
--  T2152.COE                        ,
  T6764.COUNTRY                    ,
  T2106.CURRENCY_CODE              ,
  CASE
    WHEN T6767.VENDOR_CODE BETWEEN '030001' AND '042999'
    THEN 'IC'
    ELSE 'EC'
  END                              AS IC_EC,
  T10158.MAIL_STOP                 ,
  T6767.VENDOR_NAME                ,
  T6767.VENDOR_CODE                ,
--  T2152.TEAMLEADER                 ,
 -- T2106.TRANSPORTATION_LEAD_TIME   ,
  T2106.TYPE_LOOKUP_CODE           ,
--  T1731.FULL_NAME                  ,
  T1740.FULL_NAME                  ,
--  T2162.NOTE_TO_BUYER              ,
--  T2162.SO_NUMBER                  ,
  T2080.CONTACT_MAIL_FIXED AS SPA_MAIL,
  T2080.COE_RESPONSIBILITY         ,
  T2080.FULFILLMENT_RESPONSIBILITY ,
  T2080.SPA_NAME_FIXED             
--- T2150.NEW_PNL                    ,
--  T2126.PROJECT_CODE               ,
--  T2126.PROJECT_DESCRIPTION        ,
--  T2126.PROJECT_NAME               ,
--  CASE
--    WHEN T2126.PROJECT_ID         IN ('9000061')
--    OR T2150.FUNCTION_DESCRIPTION IN ('TMS - FLOW', 'TMS - IND PLANT', 'TMS - INST', 'TMS - LNG', 'TMS - MIDSTREAM', 'TMS - POWERGEN', 'TMS - UNIT HQ', 'TMS - UPSTREAM')
--    THEN 'TMS - NEW UNITS'
--    WHEN T2150.FUNCTION_DESCRIPTION IN ('TMS - OPEX CS', 'TMS - OPEX TX')
--    THEN 'TMS - OPEX'
--    WHEN T2150.FUNCTION_DESCRIPTION = 'TMS - UPGRADES'
--    THEN 'TMS - UPGRADES'
--    WHEN T2150.FUNCTION_DESCRIPTION = 'TMS - SER HQ'
--    THEN 'TMS - HQ'
--    WHEN SUBSTR(T2150.FUNCTION_DESCRIPTION , 1, 3) = 'DTS'
--    THEN 'DTS'
--    ELSE 'SoftandOthers'
--  END AS PROJTYPE,
FROM ( ( ( ( ( ( ( ( ( ( ( ( ( ( CUST_OG_BIT_DM.DM_F116_PO_ORDERS T2106
  /* Dim_SOU_DM_F116_PO_ORDERS */
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D022_HR_ALL_PEOPLE T1738
  /* Dim_SOU_DM_D022_HR_ALL_PEOPLES */
ON T1738.PERSON_ID              = T2106.BUYER_ID
AND T1738.EFFECTIVE_END_DATE   >= TO_DATE('2017-09-27' , 'YYYY-MM-DD')
AND T1738.EFFECTIVE_START_DATE <= TO_DATE('2017-09-27' , 'YYYY-MM-DD'))
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_M154_PO_VENDOR_CONTACTS T10158
  /* Dim_SOU_DM_M154_PO_VENDOR_CONTACTS */
ON T2106.VENDOR_CONTACT_ID = T10158.VENDOR_CONTACT_ID
AND T2106.VENDOR_SITE_ID   = T10158.VENDOR_SITE_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D311_PO_BUYER_TL_COE T2152
  /* Dim_SOU_DM_D311_PO_BUYER_TL_COE */
ON T2106.BUYER_ID = T2152.BUYER_ID
AND T2106.ORG_ID  = T2152.ORG_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_M152_PO_VENDOR_SITES T6764
  /* Dim_SOU_DM_M152_PO_VENDOR_SITES */
ON T2106.VENDOR_SITE_ID = T6764.VENDOR_SITE_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_M151_PO_VENDORS T6767
  /* Dim_SOU_DM_M151_PO_VENDORS */
ON T2106.VENDOR_ID = T6767.VENDOR_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D047_AP_TERMS T3528
  /* Dim_SOU_DM_D047_AP_TERMS */
ON T2106.TERM_ID = T3528.TERM_ID)
INNER JOIN ( ( ( ( ( CUST_OG_BIT_DM.DM_F119_PO_REQUISITIONS T2077
  /* Dim_SOU_DM_F119_PO_REQUISITIONS */
INNER JOIN ( ( ( ( CUST_OG_BIT_DM.DM_F120_PO_REQ_DETAILS T2162
  /* Dim_SOU_DM_F120_PO_REQ_DETAILS */
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D022_HR_ALL_PEOPLE T1740
  /* Dim_SOU_DM_D022_HR_ALL_PEOPLE_REQS */
ON T1740.PERSON_ID              = T2162.REQUESTOR_ID
AND T1740.EFFECTIVE_END_DATE   >= TO_DATE('2017-09-27' , 'YYYY-MM-DD')
AND T1740.EFFECTIVE_START_DATE <= TO_DATE('2017-09-27' , 'YYYY-MM-DD'))
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D312_PO_BUYER_DETAILS T2116
  /* Dim_SOU_DM_D312_PO_BUYER_DETAILS */
ON T2116.POR_DISTRIBUTION_ID    = T2162.REQ_DISTRIBUTION_ID
AND T2116.REQUISITION_HEADER_ID = T2162.REQUISITION_HEADER_ID
AND T2116.REQUISITION_LINE_ID   = T2162.REQUISITION_LINE_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D011_INVENTORY_ITEMS T6140
  /* Dim_SOU_DM_D011_INVENTORY_ITEMS_RT */
ON T2162.DESTINATION_ORGANIZATION_ID = T6140.ORGANIZATION_ID
AND T2162.ITEM_ID                    = T6140.INVENTORY_ITEM_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D507_MAIN_ITEM_FALG T5192
  /* Dim_SOU_DM_D507_MAIN_ITEM_FALG_Req */
ON T2162.DUMMY_ITEM_CODE       = T5192.LONG_DUMMY)
ON T2077.REQUISITION_HEADER_ID = T2162.REQUISITION_HEADER_ID)
INNER JOIN ( CUST_OG_BIT_DM.DM_F117_PO_ORD_DETAILS T2148
  /* F_SOU_DM_F117_PO_ORD_DETAILS */
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D012_HR_ALL_ORG_UNITS T2156
  /* Dim_SOU_DM_D012_HR_ALL_ORG_UNITS */
ON T2148.SHIP_TO_ORGANIZATION_ID = T2156.ORGANIZATION_ID)
ON T2148.REQ_JOIN_KEY            = T2162.PO_JOIN_KEY)
LEFT OUTER JOIN ( CUST_OG_BIT_DM.DM_F029_PO_RELEASES T2135
  /* Dim_SOU_DM_F029_PO_RELEASES */
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D022_HR_ALL_PEOPLE T1731
  /* Dim_SOU_DM_D022_HR_ALL_PEOPLE_RELS */
ON T1731.DM_D022_SEQ            = T2135.DM_D022_SEQ
AND T1731.EFFECTIVE_END_DATE   >= TO_DATE('2017-09-27' , 'YYYY-MM-DD')
AND T1731.EFFECTIVE_START_DATE <= TO_DATE('2017-09-27' , 'YYYY-MM-DD'))
ON T2135.PO_RELEASE_ID          = T2148.PO_RELEASE_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D051_MTL_CATEGORIES T2158
  /* Dim_SOU_DM_D051_MTL_CATEGORIES */
ON T2148.ITEM_CATEGORY_ID = T2158.CATEGORY_ID)
LEFT OUTER JOIN ( CUST_OG_BIT_DM.DM_D007_PROJECTS_PA T2126
  /* Dim_SOU_DM_D007_PROJECTS_PA */
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_M026_PA_PRJ_CLASSES T2150
  /* Dim_SOU_DM_M026_PA_PRJ_CLASSES */
ON T2126.DM_D007_SEQ  = T2150.DM_D007_SEQ)
ON T2126.PROJECT_ID   = T2148.PROJECT_ID)
ON T2106.PO_HEADER_ID = T2148.PO_HEADER_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_F129_NPPOS_FMS_SHIP T10156
  /* Dim_SOU_DM_F129_NPPOS_FMS_SHIP */
ON T2148.LINE_LOCATION_ID = T10156.LINE_LOCATION_ID)
LEFT OUTER JOIN ( ( ( CUST_OG_BIT_DM.DM_M179_OKC_CONTRACT_EXTN T10229
  /* Dim_SOU_DM_M179_OKC_CONTRACT_EXTN */
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D022_HR_ALL_PEOPLE T2100
  /* Dim_SOU_DM_D022_HR_ALL_PEOPLE_ENGG */
ON T2100.DM_D022_SEQ = T10229.DMD_DM_D022_ENGG_SEQ)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D022_HR_ALL_PEOPLE T2104
  /* Dim_SOU_DM_D022_HR_ALL_PEOPLE_PLN */
ON T2104.DM_D022_SEQ = T10229.DMD_DM_D022_PLN_SEQ)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D022_HR_ALL_PEOPLE T8701
  /* Dim_SOU_DM_D022_HR_ALL_PEOPLE_PJM */
ON T8701.DM_D022_SEQ = T10229.DMD_DM_D022_MGR_SEQ)
ON T2148.PROJECT_ID  = T10229.PROJECT_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_F112_NPPO_ARR_LINES_ALL T2909
  /* Dim_SOU_DM_F112_NPPO_ARR_LINES_ALLS */
ON T2148.LINE_LOCATION_ID = T2909.LINE_LOCATION_ID
AND T2909.RNK_ARR_DT      = 1)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_F095_RCV_TRANS_EXTN T11079
  /* Dim_SOU_DM_F095_RCV_TRANS_EXTN */
ON T2148.PO_ORD_DETAILS_KEY = T11079.PO_ORD_DETAILS_KEY)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_F104_PO_SPA_SUPP T2080
  /* Dim_SOU_DM_F104_PO_SPA_SUPP */
ON T2080.LINE_LOCATION_ID = T2148.LINE_LOCATION_ID
AND T2080.PO_HEADER_ID    = T2148.PO_HEADER_ID
AND T2080.PO_LINE_ID      = T2148.PO_LINE_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D063_PA_TASKS T6769
  /* Dim_SOU_DM_D063_PA_TASKS */
ON T2148.TASK_ID = T6769.TASK_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_D011_INVENTORY_ITEMS T3524
  /* Dim_SOU_DM_D011_INVENTORY_ITEMS */
ON T2148.INVENTORY_ORGANIZATION_ID = T3524.ORGANIZATION_ID
AND T2148.ITEM_ID                  = T3524.INVENTORY_ITEM_ID)
LEFT OUTER JOIN CUST_OG_BIT_DM.DM_M180_SPIR_FLAG T11614
  /* Dim_SOU_DM_M180_SPIR_FLAG */
ON T2148.PO_DISTRIBUTION_ID           = T11614.PO_DISTRIBUTION_ID
WHERE ( T2077.REQUISITION_HEADER_ID   = T2162.REQUISITION_HEADER_ID )
AND ( T2148.LINE_LOC_CANCEL_FLAG NOT IN ('Y')
AND T6767.VENDOR_CODE NOT            IN ('030001', '030023')
AND T2148.DESTINATION_TYPE_CODE       = 'INVENTORY'
AND T2148.PROMISED_DATE < SYSDATE+1
AND (T2148.LINE_LOC_CLOSED_CODE      IN ('CLOSED FOR INVOICE', 'OPEN'))
AND (T2106.AUTHORIZATION_STATUS      IN ('APPROVED', 'REQUIRES REAPPROVAL'))
AND (T2106.ORG_ID                    IN (84, 13355))
--AND (T2106.ORG_ID                    IN (13355))
AND (T2135.AUTHORIZATION_STATUS      IN ('APPROVED', 'REQUIRES REAPPROVAL')
OR T2135.AUTHORIZATION_STATUS        IS NULL) )
  




